<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="kadina">
    
    <title>
        
            微服务架构雪崩效应与服务限流 |
        
        kadina&#39;s Blog
    </title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="shortcut icon" href="../../../../images/logo.svg">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"https:///kadina11.github.io","root":"/","language":"en","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"道阻且长 行则将至"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.1"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="atom.xml" title="kadina's Blog" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            <a class="logo-title" href="/">
                kadina&#39;s Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="../../../../index.html"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="../../../../archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="../../../../categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="../../../../tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="../../../../links"
                            >
                                LINKS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="../../../../about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../../../../index.html">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../../../../archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../../../../categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../../../../tags">TAGS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../../../../links">LINKS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="../../../../about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">微服务架构雪崩效应与服务限流</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="../../../../images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">kadina</span>
                        
                            <span class="author-label">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2022-05-21 21:52:11
    </span>
    
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>4.8k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>17 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="系统保护：微服务架构雪崩效应与服务限流"><a href="#系统保护：微服务架构雪崩效应与服务限流" class="headerlink" title="系统保护：微服务架构雪崩效应与服务限流"></a>系统保护：微服务架构雪崩效应与服务限流</h1><h2 id="微服务的雪崩效应"><a href="#微服务的雪崩效应" class="headerlink" title="微服务的雪崩效应"></a>微服务的雪崩效应</h2><p>“雪崩”一词指的是山地积雪由于底部溶解等原因造成的突然大块塌落的现象，具有很强的破坏力。在微服务项目中指由于突发流量导致某个服务不可用，从而导致上游服务不可用，并产生级联效应，最终导致整个系统不可用，使用雪崩这个词来形容这一现象最合适不过。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/1.png" alt="服务雪崩" loading="lazy"></p>
<center>一次线上的服务雪崩事故</center>

<h3 id="为什么微服务会产生雪崩效应"><a href="#为什么微服务会产生雪崩效应" class="headerlink" title="为什么微服务会产生雪崩效应"></a>为什么微服务会产生雪崩效应</h3><p>如下图所示，假如我们开发了一套分布式应用系统，前端应用分别向 A/H/I/P 四个服务发起调用请求：<br><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/2.png" alt="前端应用需要四个服务" loading="lazy"></p>
<center>前端应用需要四个服务</center>

<p>但随着时间推移，假如服务 I 因为优化问题，导致需要 20 秒才能返回响应，这就必然会导致 20 秒内该请求线程会一直处于阻塞状态</p>
<p>但是，如果这种状况放在高并发场景下，就绝对不允许出现，假如在 20 秒内有 10 万个请求通过应用访问到后端微服务。容器会因为大量请求阻塞积压导致连接池爆满，而这种情况后果极其严重！轻则“服务无响应”，重则前端应用直接崩溃。</p>
<p>以上这种因为某一个节点长时间处理导致应用请求积压崩溃的现象被称为微服务的“雪崩效应”。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/3.png" alt="大量线程积压" loading="lazy"></p>
<center>当大量线程积压后，前端应用崩溃，雪崩效应产生</center>

<h3 id="如何有效避免雪崩效应？"><a href="#如何有效避免雪崩效应？" class="headerlink" title="如何有效避免雪崩效应？"></a>如何有效避免雪崩效应？</h3><p>刚才我们分析了雪崩效应是因为出现瞬间大流量+微服务响应慢造成的。针对这两点在架构设计时要采用不同方案。</p>
<ol>
<li><p>采用限流方式进行预防：可以采用限流方案，控制请求的流入，让流量有序的进入应用，保证流量在一个可控的范围内。</p>
</li>
<li><p>采用服务降级与熔断进行补救：针对响应慢问题，可以采用服务降级与熔断进行补救。服务降级是指当应用处理时间超过规定上限后，无论服务是否处理完成，便立即触发服务降级，响应返回预先设置的异常信息。</p>
</li>
</ol>
<h2 id="Alibaba-Sentinel"><a href="#Alibaba-Sentinel" class="headerlink" title="Alibaba Sentinel"></a>Alibaba Sentinel</h2><p>在 Spring Cloud Alibaba 生态中有一个重要的流控组件 Sentinel。Sentinel 以流量为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</p>
<h3 id="Sentinel-具有以下特征。"><a href="#Sentinel-具有以下特征。" class="headerlink" title="Sentinel 具有以下特征。"></a>Sentinel 具有以下特征。</h3><ul>
<li><p><strong>丰富的应用场景</strong>：Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景，例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。</p>
</li>
<li><p><strong>完备的实时监控</strong>：Sentinel 同时提供实时的监控功能。您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。</p>
</li>
<li><p><strong>广泛的开源生态</strong>：Sentinel 提供开箱即用的与其他开源框架/库的整合模块，例如与 Spring Cloud、Dubbo、gRPC 整合只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。</p>
</li>
<li><p><strong>完善的 SPI 扩展点</strong>：Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等。</p>
</li>
</ul>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/4.png" alt="Alibaba Sentinel特性图" loading="lazy"></p>
<center>Alibaba Sentinel特性图</center>

<h3 id="Sentinel-配置入门"><a href="#Sentinel-配置入门" class="headerlink" title="Sentinel 配置入门"></a>Sentinel 配置入门</h3><p>Sentinel 分为两个部分：Sentinel Dashboard和Sentinel 客户端。</p>
<ul>
<li><p><strong>Sentinel Dashboard</strong>：Sentinel Dashboard 是 Sentinel 配套的可视化控制台与监控仪表盘套件，它支持节点发现，以及健康情况管理、监控（单机和集群）、规则管理和推送的功能。Sentinel Dashboard 是基于 Spring Boot 开发的 WEB 应用，打包后可以直接运行。</p>
</li>
<li><p><strong>Sentinel 客户端</strong>：Sentinel 客户端需要集成在 Spring Boot 微服务应用中，用于接收来自 Dashboard 配置的各种规则，并通过 Spring MVC Interceptor 拦截器技术实现应用限流、熔断保护。</p>
</li>
</ul>
<h3 id="部署-Sentinel-Dashboard（仪表盘）"><a href="#部署-Sentinel-Dashboard（仪表盘）" class="headerlink" title="部署 Sentinel Dashboard（仪表盘）"></a>部署 Sentinel Dashboard（仪表盘）</h3><ol>
<li><p>访问：<a class="link" target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/releases%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E7%89%88">https://github.com/alibaba/Sentinel/releases，下载最新版<i class="fas fa-external-link-alt"></i></a> Sentinel Dashboard。</p>
</li>
<li><p>利用下面的命令启动 Dashboard。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar -Dserver.port=<span class="number">9100</span> sentinel-dashboard-<span class="number">1</span>.<span class="number">8</span>.<span class="number">0</span>.jar</span><br></pre></td></tr></table></figure></li>
</ol>
<p>这个命令的含义是启动 Sentinel Dashboard 应用，Sentinel Dashboard 会监听9100端口实现与微服务的通信。同时我们可以访问下面的网址查看 Sentinel Dashboard 的UI界面。<br><a class="link" target="_blank" rel="noopener" href="http://192.168.31.10:9100/">http://192.168.31.10:9100<i class="fas fa-external-link-alt"></i></a></p>
<p>在用户名、密码处输入 sentinel/sentinel，便可进入 Dashboard。</p>
<h3 id="微服务内置-Sentinel-客户端"><a href="#微服务内置-Sentinel-客户端" class="headerlink" title="微服务内置 Sentinel 客户端"></a>微服务内置 Sentinel 客户端</h3><p>第一步，利用 Spring Initializr 向导创建 sentinel-sample 工程，pom.xml 增加以下三项依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Nacos客户端Starter--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Sentinel客户端Starter--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 对外暴露Spring Boot监控指标--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>第二步，配置 Nacos 与 Sentinel 客户端。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">sentinel-sample</span> <span class="comment">#应用名&amp;微服务id</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span> <span class="comment">#Sentinel Dashboard通信地址</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="number">192.168</span><span class="number">.31</span><span class="number">.10</span><span class="string">:9100</span></span><br><span class="line">      <span class="attr">eager:</span> <span class="literal">true</span> <span class="comment">#取消控制台懒加载</span></span><br><span class="line">    <span class="attr">nacos:</span> <span class="comment">#Nacos通信地址</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.31</span><span class="number">.10</span><span class="string">:8848</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span> <span class="comment">#将所有可用的监控指标项对外暴露</span></span><br><span class="line">      <span class="attr">exposure:</span> <span class="comment">#可以访问 /actuator/sentinel进行查看Sentinel监控项</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>

<p>第三步，验证配置。</p>
<p>在 Sentinel Dashboard 左侧看到 sentinel-sample 服务出现，则代表 Sentinel 客户端与 Dashboard 已经完成通信。<br><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/5.png" alt="Sentinel Dashboard" loading="lazy"></p>
<h3 id="配置限流规则"><a href="#配置限流规则" class="headerlink" title="配置限流规则"></a>配置限流规则</h3><p>第一步，在 sentinel-sample 服务中，增加 SentinelSampleController 类，用于演示 Sentinel 限流规则。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SentinelSampleController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test_flow_rule&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testFlowRule</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SUCCESS&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动 sentinel-sample，访问<a class="link" target="_blank" rel="noopener" href="http://localhost/test_flow_rule%EF%BC%8C%E6%97%A0%E8%AE%BA%E5%88%B7%E6%96%B0%E5%A4%9A%E5%B0%91%E6%AC%A1%EF%BC%8C%E9%83%BD%E4%BC%9A%E7%9C%8B%E5%88%B0%E2%80%9CSUCCESS%E2%80%9D%E3%80%82">http://localhost/test_flow_rule，无论刷新多少次，都会看到“SUCCESS”。<i class="fas fa-external-link-alt"></i></a></p>
<p>第二步，访问 Sentinel Dashboard 配置限流规则。<br>在左侧找到簇点链路，右侧定位到 /test_flow_rule，点击后面的“流控”按钮。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/6.png" alt="配置限流规则" loading="lazy"></p>
<p>在弹出界面，按下图配置，其含义为 /test_flow_rule 接口每秒钟只允许 1QPS 访问，超出的请求直接服务降级返回异常。最后点击“新增”完成规则设置。</p>
<p>第三步，验证流控效果。</p>
<p>重新访问<a class="link" target="_blank" rel="noopener" href="http://localhost/test_flow_rule%EF%BC%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%8D%E5%A4%8D%E5%88%B7%E6%96%B0%E3%80%82">http://localhost/test_flow_rule，浏览器反复刷新。<i class="fas fa-external-link-alt"></i></a></p>
<p>第一次刷新时会出现“SUCCESS”文本代表处理成功。</p>
<p>同一秒内再次刷新便会出现 “Blocked by Sentinel (flow limiting)”，代表服务已被限流降级。<br><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/7.png" alt="服务已被限流降级" loading="lazy"></p>
<h3 id="Sentinel-Dashboard通信与降级原理"><a href="#Sentinel-Dashboard通信与降级原理" class="headerlink" title="Sentinel Dashboard通信与降级原理"></a>Sentinel Dashboard通信与降级原理</h3><p>Sentinel Dashboard 是Sentinel的控制端，是新的限流与熔断规则的创建者。当内置在微服务内的 Sentinel Core（客户端）接收到新的限流、熔断规则后，微服务便会自动启用的相应的保护措施。</p>
<p>按执行流程，Sentinel 的执行流程分为三个阶段：</p>
<ol>
<li><p>Sentinel Core 与 Sentinel Dashboard 建立连接；</p>
</li>
<li><p>Sentinel Dashboard 向 Sentinel Core 下发新的保护规则；</p>
</li>
<li><p>Sentinel Core 应用新的保护规则，实施限流、熔断等动作。</p>
</li>
</ol>
<h4 id="第一步，建立连接。"><a href="#第一步，建立连接。" class="headerlink" title="第一步，建立连接。"></a>第一步，建立连接。</h4><p>Sentine Core 在初始化的时候，通过 application.yml 参数中指定的 Dashboard 的 IP地址，会主动向 dashboard 发起连接的请求。</p>
<p>该请求是以心跳包的方式定时向 Dashboard 发送，包含 Sentinel Core 的 AppName、IP、端口信息。这里有个重要细节：Sentinel Core为了能够持续接收到来自 Dashboard的数据，会在微服务实例设备上监听 8719 端口，在心跳包上报时也是上报这个 8719 端口，而非微服务本身的 80 端口。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/8.png" alt="Sentinel Core 向 Dashboard 建立连接" loading="lazy"></p>
<center>Sentinel Core 向 Dashboard 建立连接</center>

<h4 id="第二步，推送新规则。"><a href="#第二步，推送新规则。" class="headerlink" title="第二步，推送新规则。"></a>第二步，推送新规则。</h4><p>如果在 Dashboard 页面中设置了新的保护规则，会先从当前的 MachineInfo 中提取符合要求的微服务实例信息，之后通过 Dashboard内置的 transport 模块将新规则打包推送到微服务实例的 Sentinel Core，Sentinel Core收 到新规则在微服务应用中对本地规则进行更新，这些新规则会保存在微服务实例的 JVM 内存中。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/9.png" alt="Sentinel Dashboard 向Sentinel Core推送新规则" loading="lazy"></p>
<center>Sentinel Dashboard 向Sentinel Core推送新规则</center>

<h4 id="第三步，处理请求。"><a href="#第三步，处理请求。" class="headerlink" title="第三步，处理请求。"></a>第三步，处理请求。</h4><p>Sentinel Core 为服务限流、熔断提供了核心拦截器 SentinelWebInterceptor，这个拦截器默认对所有请求 /** 进行拦截，然后开始请求的链式处理流程，在对于每一个处理请求的节点被称为 Slot（槽），通过多个槽的连接形成处理链，在请求的流转过程中，如果有任何一个 Slot 验证未通过，都会产生 BlockException，请求处理链便会中断，并返回“Blocked by sentinel” 异常信息。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/10.png" alt="SentinelWebInterceptor 实施请求拦截与保护" loading="lazy"></p>
<center>SentinelWebInterceptor 实施请求拦截与保护</center>

<p>那这些 Slot 都有什么作用呢？我们需要了解一下，默认 Slot 有7 个，前 3 个 Slot为前置处理，用于收集、统计、分析必要的数据；后 4 个为规则校验 Slot，从Dashboard 推送的新规则保存在“规则池”中，然后对应 Slot 进行读取并校验当前请求是否允许放行，允许放行则送入下一个 Slot 直到最终被 RestController 进行业务处理，不允许放行则直接抛出 BlockException 返回响应。</p>
<p>以下是每一个 Slot 的具体职责：</p>
<ul>
<li><p>NodeSelectorSlot 负责收集资源的路径，并将这些资源的调用路径，以树状结构存储起来，用于根据调用路径来限流降级；</p>
</li>
<li><p>ClusterBuilderSlot 则用于存储资源的统计信息以及调用者信息，例如该资源的 RT（运行时间）, QPS, thread count（线程总数）等，这些信息将用作为多维度限流，降级的依据；</p>
</li>
<li><p>StatistcSlot 则用于记录，统计不同维度的runtime 信息；</p>
</li>
<li><p>SystemSlot 则通过系统的状态，例如CPU、内存的情况，来控制总的入口流量；</p>
</li>
<li><p>AuthoritySlot 则根据黑白名单，来做黑白名单控制；</p>
</li>
<li><p>FlowSlot 则用于根据预设的限流规则，以及前面 slot 统计的状态，来进行限流；</p>
</li>
<li><p>DegradeSlot 则通过统计信息，以及预设的规则，来做熔断降级。</p>
</li>
</ul>
<h3 id="Sentinel-限流降级的规则配置"><a href="#Sentinel-限流降级的规则配置" class="headerlink" title="Sentinel 限流降级的规则配置"></a>Sentinel 限流降级的规则配置</h3><h4 id="滑动窗口算法"><a href="#滑动窗口算法" class="headerlink" title="滑动窗口算法"></a>滑动窗口算法</h4><p>实现限流降级的核心是如何统计单位时间某个接口的访问量，常见的算法有计数器算法、令牌桶算法、漏桶算法、滑动窗口算法。Sentinel 采用滑动窗口算法来统计访问量。</p>
<p>滑动窗口算法并不复杂，咱们举例说明：某应用限流控制 1 分钟最多允许 600 次访问。采用滑动窗口算法是将每 1 分钟拆分为 6（变量）个等份时间段，每个时间段为 10 秒，6 个时间段为 1 组在下图用红色边框区域标出，而这个红色边框区域就是滑动窗口。当每产生 1 个访问在对应时间段的计数器自增加 1，当滑动窗口内所有时间段的计数器总和超过 600，后面新的访问将被限流直接拒绝。同时每过 10 秒，滑动窗口向右移动，前面的过期时间段计数器将被作废。</p>
<p>总结下，滑动窗口算法的理念是将整段时间均分后独立计数再汇总统计，滑动窗口算法被广泛应用在各种流控场景中，请你理解它的实现过程。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/11.png" alt="SentinelWebInterceptor 实施请求拦截与保护" loading="lazy"></p>
<center>滑动窗口算法</center>

<h4 id="基于-Sentinel-Dashboard-的限流设置"><a href="#基于-Sentinel-Dashboard-的限流设置" class="headerlink" title="基于 Sentinel Dashboard 的限流设置"></a>基于 Sentinel Dashboard 的限流设置</h4><p>在 Sentinel Dashboard 中“簇点链路”,找到需要限流的 URI，点击“+流控”进入流控设置。小提示，sentinel-dashboard 基于懒加载模式，如果在簇点链路没有找到对应的 URI，需要先访问下这个功能的功能后对应的 URI 便会出现。<br><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/12.png" alt="流控设置界面" loading="lazy"></p>
<center>流控设置界面</center>

<p>流控规则项目说明主要有以下几点。</p>
<ul>
<li><p><strong>资源名</strong>：要流控的 URI，在 Sentinel 中 URI 被称为“资源”；</p>
</li>
<li><p><strong>针对来源</strong>：默认 default 代表所有来源，可以针对某个微服务或者调用者单独设置；</p>
</li>
<li><p><strong>阈值类型</strong>：是按每秒访问数量（QPS）还是并发数（线程数）进行流控；</p>
</li>
<li><p><strong>单机阈值</strong>：具体限流的数值是多少。</p>
</li>
</ul>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/13.png" alt="默认流控规则" loading="lazy"></p>
<center></center>

<p>点击对话框中的“高级选项”，就会出现更为详细的设置项。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/14.png" alt="高级选项" loading="lazy"></p>
<p>其中流控模式是指采用什么方式进行流量控制。Sentinel支持三种模式：直接、关联、链路，下面咱们分别讲解这三种模式。</p>
<ul>
<li><strong>直接模式：</strong></li>
</ul>
<p>以下图为例，当 List 接口 QPS 超过 1个时限流，浏览器会出现“Blocked by Sentinel”。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/15.png" alt="直接模式" loading="lazy"></p>
<center>流控模式-直接</center>


<ul>
<li><strong>关联模式：</strong></li>
</ul>
<p>如下图所示，当同 List 接口关联的update 接口 QPS 超过 1 时，再次访问List 接口便会响应“Blocked by Sentinel”。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/16.png" alt="关联模式" loading="lazy"></p>
<center>流控模式-关联</center>


<ul>
<li><strong>链路模式：</strong></li>
</ul>
<p>链路模式相对复杂，我们举例说明，现在某公司开发了一个单机的电商系统，为了满足完成“下订单”的业务，程序代码会依次执行订单创建方法-&gt;减少库存方法-&gt;微信支付方法-&gt;短信发送方法。方法像链条一样从前向后依次执行，这种执行的链条被称为调用链路，而链路模式限流就是为此而生。</p>
<p>以下图为例，在某个微服务中 List 接口，会被 Check 接口调用。在另一个业务，List 接口也会被 Scan 接口调用。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/17.png" alt="调用链路" loading="lazy"></p>
<center>调用链路</center>

<p>但如果按下图配置，将入口资源设为“/check”，则只会针对 check 接口的调用链路生效。当访问 check 接口的QPS 超过 1 时，List 接口就会被限流。而另一条链路从 scan 接口到List 接口的链路则不会受到任何影响。链路模式与关联模式最大的区别是 check 接口与 List 接口必须是在同一个调用链路中才会限流，而关联模式是任意两个资源只要设置关联就可以进行限流。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/18.png" alt="调用链路" loading="lazy"></p>
<center>流控模式-链路</center>

<p>流控效果有三种：<strong>快速失败</strong>、<strong>Warm UP（预热）</strong>、<strong>排队等待</strong>。</p>
<h5 id="快速失败"><a href="#快速失败" class="headerlink" title="快速失败"></a><strong>快速失败</strong></h5><p>快速失败是指流浪当过限流阈值后，直接返回响应并抛出 BlockException，快速失败是最常用的处理形式。如下图所示，当 List 接口每秒 QPS 超过 1 时，可以直接抛出“Blocked By Sentinel”异常。</p>
<h5 id="Warm-Up（预热"><a href="#Warm-Up（预热" class="headerlink" title="Warm Up（预热"></a><strong>Warm Up（预热</strong></h5><p>Warm Up 用于应对瞬时大并发流量冲击。当遇到突发大流量 Warm Up 会缓慢拉升阈值限制，预防系统瞬时崩溃，这期间超出阈值的访问处于队列等待状态，并不会立即抛出 BlockException。</p>
<p>如下图所示，List 接口平时单机阈值 QPS 处于低水位：默认为 1000/3 (冷加载因子)≈333，当瞬时大流量进来，10 秒钟内将 QPS 阈值逐渐拉升至 1000，为系统留出缓冲时间，预防突发性系统崩溃。<br><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/19.png" alt="流控效果-Warm Up" loading="lazy"></p>
<center>流控效果-Warm Up</center>


<h5 id="排队等待"><a href="#排队等待" class="headerlink" title="排队等待"></a><strong>排队等待</strong></h5><p>排队等待是采用匀速放行的方式对请求进行处理。如下所示，假设现在有100个请求瞬间进入，那么会出现以下几种情况：</p>
<ol>
<li><p>单机 QPS 阈值=1，代表每 1 秒只能放行 1 个请求，其他请求队列等待，共需 100 秒处理完毕；</p>
</li>
<li><p>单机 QPS 阈值=4，代表 250 毫秒匀速放行 1 个请求，其他请求队列等待，共需 25 秒处理完毕；</p>
</li>
<li><p>单机 QPS 阈值=200，代表 5 毫秒匀速放行一个请求，其他请求队列等待，共需 0.5 秒处理完毕；</p>
</li>
<li><p>如果某一个请求在队列中处于等待状态超过 2000 毫秒，则直接抛出 BlockException。</p>
</li>
</ol>
<p>注意，匀速队列只支持 QPS 模式，且单机阈值不得大于 1000。</p>
<h3 id="Sentinel-熔断降级的规则配置"><a href="#Sentinel-熔断降级的规则配置" class="headerlink" title="Sentinel 熔断降级的规则配置"></a>Sentinel 熔断降级的规则配置</h3><h4 id="什么是熔断？"><a href="#什么是熔断？" class="headerlink" title="什么是熔断？"></a>什么是熔断？</h4><p>先说现实中的股市熔断机制。2016 年 1 月 4 日，A 股遇到史上首次熔断，沪指开盘后跌幅超过 5%，直接引发熔断。三家股市交易所暂停交易15分钟，但恢复交易之后股市继续下跌，三大股市交易所暂停交易至闭市。通过现象可以看出熔断是一种保护机制，当事物的状态达到某种“不可接受”的情况时，便会触发“熔断”。在股市中，熔断条件就是大盘跌幅超过 5%，而熔断的措施便是强制停止交易 15 分钟，之后尝试恢复交易，如仍出现继续下跌，便会再次触发熔断直接闭市。但假设 15分钟后，大盘出现回涨，便认为事故解除继续正常交易。这是现实生活中的熔断，如果放在软件中也是一样的。</p>
<p>微服务的熔断是指在某个服务接口在执行过程中频繁出现故障的情况，我们便认为这种状态是“不可接受”的，立即对当前接口实施熔断。在规定的时间内，所有送达该接口的请求都将直接抛出 BlockException，在熔断期过后新的请求进入看接口是否恢复正常，恢复正常则继续运行，仍出现故障则再次熔断一段时间，以此往复直到服务接口恢复。</p>
<p>下图清晰的说明了 Sentinel的熔断过程：</p>
<ol>
<li>设置熔断的触发条件，当某接口超过20%的请求访问出现故障，便启动熔断；</li>
<li>在熔断状态下，若干秒内所有该接口的请求访问都会直接抛出BlockException拒绝访问。</li>
<li>熔断器过后，下一次请求重新访问接口，当前接口为“半开状态”，后续处理以下分两种情况。<br>&nbsp;- 当前请求被有效处理，接口恢复到正常状态。<br>&nbsp;- 当前请求访问出现故障，接口继续熔断。</li>
</ol>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/20.png" alt="Sentinel 熔断机制" loading="lazy"></p>
<center>Sentinel 熔断机制</center>

<h4 id="基于SentinelDashboard的熔断设置"><a href="#基于SentinelDashboard的熔断设置" class="headerlink" title="基于SentinelDashboard的熔断设置"></a>基于SentinelDashboard的熔断设置</h4><p>Sentinel Dashboard可以设置三种不同的熔断模式：慢调用比例、异常比例、异常数，下面我们分别讲解：</p>
<h5 id="慢调用比例"><a href="#慢调用比例" class="headerlink" title="慢调用比例"></a>慢调用比例</h5><p>慢调用比例是指当接口在1秒内“慢处理”数量超过一定比例，则触发熔断。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/21.png" alt="熔断模式-慢调用比例" loading="lazy"></p>
<center>熔断模式-慢调用比例</center>

<p>结合上图的设置，介绍下“慢调用比例”熔断规则。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/22.png" alt="慢调用比例" loading="lazy"></p>
<h5 id="异常比例"><a href="#异常比例" class="headerlink" title="异常比例"></a>异常比例</h5><p>异常比例是指 1 秒内按接口调用产生异常的比例（异常调用数/总数量）触发熔断。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/23.png" alt="熔断模式-异常比例" loading="lazy"></p>
<center>熔断模式-异常比例</center>

<p>结合上图的设置，介绍下“异常比例”熔断规则。<br><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/24.png" alt="异常比例" loading="lazy"></p>
<h5 id="异常数"><a href="#异常数" class="headerlink" title="异常数"></a>异常数</h5><p>异常数是指在 1 分钟内异常的数量超过阈值则触发熔断。</p>
<p><img src="/2022/05/21/2022-05-21微服务架构雪崩效应与服务限流/25.png" alt="熔断模式-异常数" loading="lazy"></p>
<center>熔断模式-异常数</center>

        </div>

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="../../22/2022-05-22%E5%9F%BA%E4%BA%8ENacos%E9%9B%86%E4%B8%AD%E7%AE%A1%E7%90%86%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">基于Nacos集中管理应用配置</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="../../20/2022-05-20SpringCloudGateway%E5%A6%82%E4%BD%95%E6%8A%8A%E5%A5%BD%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%A4%A7%E9%97%A8/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Spring Cloud Gateway 如何把好微服务的大门</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;Comments</i>
    </div>
    

        
            .valine-container {

  #vcomments {

    .vwrap {

      border: 1px solid var(--third-text-color);

      .vheader {

        .vinput {

          color: var(--default-text-color);
          border-color: var(--third-text-color);

          &:focus {
            border-bottom: 1px dashed var(--primary-color) !important;
          }
        }
      }


      .vedit {

        .veditor {
          color: var(--default-text-color);
        }

        .vctrl {

          .vicon {

            fill: var(--default-text-color);

            &.actived {
              fill: var(--primary-color);
            }
          }
        }

      }


      button.vsubmit {

        background: transparent !important;
        color: var(--default-text-color) !important;
        border: 1px solid var(--default-text-color) !important;

        &:hover {
          color: var(--primary-color) !important;
          border: 1px solid var(--primary-color) !important;
        }
      }


    }


    .vcount {
      color: var(--default-text-color);

      .vnum {
        color: var(--second-text-color);
      }
    }


    .vcard {

      .vnick {
        .author {
          font-weight: 450;
          font-size: 12px;
          padding: 2px;
          background: -webkit-linear-gradient(45deg, #e3565e, #ee854b, #f6c258, #90c68a, #5fb3b3, #6699cc, #c594c5);
          background: linear-gradient(45deg, #e3565e, #ee854b, #f6c258, #90c68a, #5fb3b3, #6699cc, #c594c5);
          color: #fff;
          margin-left: 2px;
          border-radius: 2px;
        }
      }


      .vhead {

        .vnick {
          color: var(--primary-color);
        }

        .vsys {
          color: var(--default-text-color);
          background: var(--fourth-text-color) !important;
        }
      }


      .vcontent {
        P {
          color: var(--default-text-color);

          code {
            color: var(--code-foreground);
            background: var(--code-background);
          }
        }
      }


      .vh {
        border-bottom-color: var(--border-color);
      }

      .vquote {
        border-left-color: var(--border-color);
      }
    }


    .vcopy {
      color: var(--third-text-color);
    }


    .vpage {

      .vmore {
        border: 1px solid var(--border-color);
        color: var(--second-text-color);
      }
    }


  }


}


        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">kadina</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.1</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E4%BF%9D%E6%8A%A4%EF%BC%9A%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E9%9B%AA%E5%B4%A9%E6%95%88%E5%BA%94%E4%B8%8E%E6%9C%8D%E5%8A%A1%E9%99%90%E6%B5%81"><span class="nav-text">系统保护：微服务架构雪崩效应与服务限流</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%9B%AA%E5%B4%A9%E6%95%88%E5%BA%94"><span class="nav-text">微服务的雪崩效应</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BC%9A%E4%BA%A7%E7%94%9F%E9%9B%AA%E5%B4%A9%E6%95%88%E5%BA%94"><span class="nav-text">为什么微服务会产生雪崩效应</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%9C%89%E6%95%88%E9%81%BF%E5%85%8D%E9%9B%AA%E5%B4%A9%E6%95%88%E5%BA%94%EF%BC%9F"><span class="nav-text">如何有效避免雪崩效应？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Alibaba-Sentinel"><span class="nav-text">Alibaba Sentinel</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sentinel-%E5%85%B7%E6%9C%89%E4%BB%A5%E4%B8%8B%E7%89%B9%E5%BE%81%E3%80%82"><span class="nav-text">Sentinel 具有以下特征。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sentinel-%E9%85%8D%E7%BD%AE%E5%85%A5%E9%97%A8"><span class="nav-text">Sentinel 配置入门</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2-Sentinel-Dashboard%EF%BC%88%E4%BB%AA%E8%A1%A8%E7%9B%98%EF%BC%89"><span class="nav-text">部署 Sentinel Dashboard（仪表盘）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%86%85%E7%BD%AE-Sentinel-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-text">微服务内置 Sentinel 客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%99%90%E6%B5%81%E8%A7%84%E5%88%99"><span class="nav-text">配置限流规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sentinel-Dashboard%E9%80%9A%E4%BF%A1%E4%B8%8E%E9%99%8D%E7%BA%A7%E5%8E%9F%E7%90%86"><span class="nav-text">Sentinel Dashboard通信与降级原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%8C%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E3%80%82"><span class="nav-text">第一步，建立连接。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%8C%E6%8E%A8%E9%80%81%E6%96%B0%E8%A7%84%E5%88%99%E3%80%82"><span class="nav-text">第二步，推送新规则。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%8C%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E3%80%82"><span class="nav-text">第三步，处理请求。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sentinel-%E9%99%90%E6%B5%81%E9%99%8D%E7%BA%A7%E7%9A%84%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE"><span class="nav-text">Sentinel 限流降级的规则配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E7%AE%97%E6%B3%95"><span class="nav-text">滑动窗口算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-Sentinel-Dashboard-%E7%9A%84%E9%99%90%E6%B5%81%E8%AE%BE%E7%BD%AE"><span class="nav-text">基于 Sentinel Dashboard 的限流设置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%A4%B1%E8%B4%A5"><span class="nav-text">快速失败</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Warm-Up%EF%BC%88%E9%A2%84%E7%83%AD"><span class="nav-text">Warm Up（预热</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8E%92%E9%98%9F%E7%AD%89%E5%BE%85"><span class="nav-text">排队等待</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sentinel-%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7%E7%9A%84%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE"><span class="nav-text">Sentinel 熔断降级的规则配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%86%94%E6%96%AD%EF%BC%9F"><span class="nav-text">什么是熔断？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8ESentinelDashboard%E7%9A%84%E7%86%94%E6%96%AD%E8%AE%BE%E7%BD%AE"><span class="nav-text">基于SentinelDashboard的熔断设置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%85%A2%E8%B0%83%E7%94%A8%E6%AF%94%E4%BE%8B"><span class="nav-text">慢调用比例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E6%AF%94%E4%BE%8B"><span class="nav-text">异常比例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E6%95%B0"><span class="nav-text">异常数</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/header-shrink.js"></script><script src="/js/back2top.js"></script><script src="/js/dark-light-toggle.js"></script>


    <script src="/js/local-search.js"></script>



    <script src="/js/code-copy.js"></script>




<div class="post-scripts">
    
        <script src="/js/left-side-toggle.js"></script><script src="/js/libs/anime.min.js"></script><script src="/js/toc.js"></script>
    
</div>



</body>
</html>
